<div class="space-y-6 animate-fade-in">
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
    <button (click)="onBack.emit()" class="flex items-center text-gray-500 hover:text-primary transition-all font-bold">
      <span class="material-icons-outlined mr-2">arrow_back</span> Retour aux boutiques
    </button>
    
    <div class="flex gap-2">
      @if (vendor().status === 'APPROVED') {
        <button (click)="toggleSuspension()" 
          [class]="vendor().owner.isBanned ? 'bg-green-600' : 'bg-red-600'"
          class="w-full py-2 text-white rounded-xl font-bold text-sm">
          {{ vendor().owner.isBanned ? 'Réactiver le compte' : 'Suspendre le vendeur' }}
        </button>
      }
      <button class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-bold shadow-lg shadow-primary/20">
        Contacter le vendeur
      </button>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl border border-gray-100 shadow-sm flex flex-col items-center text-center">
      <img [src]="vendor().logo || 'assets/default-store.png'" class="h-20 w-20 rounded-xl shadow-inner mb-4 object-cover bg-gray-50 p-1">
      <h2 class="text-xl font-bold dark:text-white">{{ vendor().name }}</h2>
      <p class="text-xs text-gray-400 uppercase tracking-widest font-bold mt-1">{{ vendor().category }}</p>
      
      <div class="mt-4 w-full pt-4 border-t flex flex-col gap-2">
        <p class="text-sm text-gray-600 dark:text-gray-300"><strong>Gérant:</strong> {{ vendor().ownerName }}</p>
        <p class="text-xs text-gray-500">{{ vendor().email }}</p>
      </div>

      <div class="flex justify-center gap-3 mt-4">
        <a *ngIf="vendor().socials.facebook" [href]="vendor().socials.facebook" target="_blank" class="p-2 bg-blue-50 text-blue-600 rounded-full hover:bg-blue-600 hover:text-white transition-all">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a *ngIf="vendor().socials.whatsapp" [href]="'https://wa.me/'+vendor().socials.whatsapp" target="_blank" class="p-2 bg-green-50 text-green-600 rounded-full hover:bg-green-600 hover:text-white transition-all">
          <i class="fab fa-whatsapp"></i>
        </a>
        <a *ngIf="vendor().socials.tiktok" [href]="vendor().socials.tiktok" target="_blank" class="p-2 bg-black text-white rounded-full hover:opacity-80 transition-all">
          <i class="fab fa-tiktok"></i>
        </a>
      </div>
    </div>

    <app-kapi-card title="Solde Wallet" [value]="vendor().balance + ' FCFA'" icon="account_balance_wallet" accentColor="text-green-600"></app-kapi-card>
    <app-kapi-card title="Ventes Totales" [value]="vendor().totalSales + ' FCFA'" icon="payments" accentColor="text-blue-600"></app-kapi-card>
    <app-kapi-card title="Produits" [value]="vendor().productCount" icon="inventory_2" accentColor="text-orange-500"></app-kapi-card>
  </div>

  <div class="bg-white dark:bg-gray-800 rounded-2xl border border-gray-100 shadow-sm overflow-hidden">
    <div class="flex border-b overflow-x-auto bg-gray-50/50">
      <button (click)="activeTab.set('products')" [class.border-primary]="activeTab() === 'products'" class="flex-1 py-4 px-6 text-sm font-bold border-b-2 transition-all whitespace-nowrap">
        Produits ({{ vendor().productCount }})
      </button>
      <button (click)="activeTab.set('orders')" [class.border-primary]="activeTab() === 'orders'" class="flex-1 py-4 px-6 text-sm font-bold border-b-2 transition-all whitespace-nowrap">
        Commandes
      </button>
      <button (click)="activeTab.set('dossier')" [class.border-primary]="activeTab() === 'dossier'" class="flex-1 py-4 px-6 text-sm font-bold border-b-2 transition-all whitespace-nowrap text-orange-600">
        Dossier Administratif
      </button>
      <button (click)="activeTab.set('transactions')" [class.border-primary]="activeTab() === 'transactions'" class="flex-1 py-4 px-6 text-sm font-bold border-b-2 transition-all whitespace-nowrap">
        Finances
      </button>
    </div>

    <div class="p-4">
      @switch (activeTab()) {
        @case ('products') {
          <app-data-table [columns]="productCols" [data]="vendor().products" [itemsPerPage]="5"></app-data-table>
        }
        @case ('orders') {
          <app-data-table [columns]="orderCols" [data]="vendor().orders" [itemsPerPage]="5"></app-data-table>
        }
        @case ('dossier') {
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-4">
              <h4 class="text-xs font-black text-gray-400 uppercase">Informations Personnelles</h4>
              <div class="bg-gray-50 p-4 rounded-2xl space-y-2">
                <p class="text-sm"><strong>Nom :</strong> {{ vendor().owner.fullName }}</p>
                <p class="text-sm"><strong>Email :</strong> {{ vendor().owner.email }}</p>
                <p class="text-sm"><strong>Téléphone :</strong> {{ vendor().owner.phone }}</p>
                <p class="text-sm"><strong>Membre depuis :</strong> {{ vendor().owner.joinedAt }}</p>
              </div>
            </div>
            </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4">
            <div (click)="viewDocument(vendor().documentRccm)" class="group border-2 border-dashed rounded-2xl p-8 flex flex-col items-center justify-center cursor-pointer hover:border-primary hover:bg-primary/5 transition-all">
               <span class="material-icons-outlined text-4xl text-gray-300 group-hover:text-primary mb-3">gavel</span>
               <p class="font-bold text-gray-700 dark:text-gray-200">Registre du Commerce (RCCM)</p>
               <span class="text-xs text-primary font-bold mt-2 underline">Cliquez pour voir le document</span>
            </div>
            <div (click)="viewDocument(vendor().documentIdentity)" class="group border-2 border-dashed rounded-2xl p-8 flex flex-col items-center justify-center cursor-pointer hover:border-primary hover:bg-primary/5 transition-all">
               <span class="material-icons-outlined text-4xl text-gray-300 group-hover:text-primary mb-3">badge</span>
               <p class="font-bold text-gray-700 dark:text-gray-200">Pièce d'Identité du Gérant</p>
               <span class="text-xs text-primary font-bold mt-2 underline">Visualiser le scan</span>
            </div>
          </div>
        }
        @case ('transactions') {
          <div *ngIf="canManageFinance(); else restricted">
            <app-data-table [columns]="transacCols" [data]="vendor().transactions">
              <ng-template let-row="row">
                <div class="flex gap-2">
                  <button class="p-1 text-blue-600" title="Détails"><span class="material-icons">visibility</span></button>
                  <button *ngIf="row.status !== 'CANCELLED'" class="p-1 text-red-600" title="Annuler"><span class="material-icons">block</span></button>
                </div>
              </ng-template>
            </app-data-table>
            
            <div class="mt-4 p-4 bg-orange-50 rounded-xl" *ngIf="vendor().transactions.length === 0">
              <p class="text-orange-700 text-sm font-medium">Aucun flux financier bloqué à afficher.</p>
            </div>
          </div>
          <ng-template #restricted>
            <div class="text-center py-12">
              <span class="material-icons text-6xl text-gray-200">lock</span>
              <p class="text-gray-400 mt-4">Accès réservé aux administrateurs financiers.</p>
            </div>
          </ng-template>
        }
      }
    </div>
  </div>
</div>